{% extends "base.html" %}

{% block title %}Analytics - StockFlow{% endblock %}

{% block content %}
<div class="analytics-page">
    <h2>Analytics Dashboard</h2>

    <div class="analytics-grid">
        <!-- Sector Distribution -->
        <div class="analytics-card">
            <h3>Sector Distribution</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Sector</th>
                        <th>Companies</th>
                        <th>Percentage</th>
                    </tr>
                </thead>
                <tbody>
                    {% set total = sector_distribution|sum(attribute='count') %}
                    {% for sector in sector_distribution %}
                    <tr>
                        <td>{{ sector.sector_name }}</td>
                        <td>{{ sector.count }}</td>
                        <td>{{ "%.1f"|format((sector.count / total * 100) if total > 0 else 0) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Top Volume Stocks -->
        <div class="analytics-card">
            <h3>Top 10 Stocks by Trading Volume</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Symbol</th>
                        <th>Company</th>
                        <th>Avg Volume (30d)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stock in top_volume_stocks %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><strong>{{ stock.symbol }}</strong></td>
                        <td>{{ stock.company_name }}</td>
                        <td>{{ "{:,.0f}".format(stock.avg_volume or 0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Most Volatile Stocks -->
        <div class="analytics-card">
            <h3>Most Volatile Stocks (30 Days)</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Symbol</th>
                        <th>Company</th>
                        <th>Price Range</th>
                        <th>Avg Price</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stock in volatile_stocks %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><strong>{{ stock.symbol }}</strong></td>
                        <td>{{ stock.company_name }}</td>
                        <td>${{ "%.2f"|format(stock.price_range or 0) }}</td>
                        <td>${{ "%.2f"|format(stock.avg_price or 0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
